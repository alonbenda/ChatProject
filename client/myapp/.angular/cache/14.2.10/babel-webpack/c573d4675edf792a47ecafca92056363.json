{"ast":null,"code":"// Copyright (c) .NET Foundation. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : new P(function (resolve) {\n        resolve(result.value);\n      }).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function () {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n\n        case 7:\n          op = _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n\n            _.ops.push(op);\n\n            break;\n          }\n\n          if (t[2]) _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n      }\n\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nimport { DefaultHttpClient } from \"./DefaultHttpClient\";\nimport { LogLevel } from \"./ILogger\";\nimport { HttpTransportType, TransferFormat } from \"./ITransport\";\nimport { LongPollingTransport } from \"./LongPollingTransport\";\nimport { ServerSentEventsTransport } from \"./ServerSentEventsTransport\";\nimport { Arg, createLogger } from \"./Utils\";\nimport { WebSocketTransport } from \"./WebSocketTransport\";\nvar MAX_REDIRECTS = 100;\nvar WebSocketModule = null;\nvar EventSourceModule = null;\n\nif (typeof window === \"undefined\" && typeof require !== \"undefined\") {\n  // In order to ignore the dynamic require in webpack builds we need to do this magic\n  // @ts-ignore: TS doesn't know about these names\n  var requireFunc = typeof __webpack_require__ === \"function\" ? __non_webpack_require__ : require;\n  WebSocketModule = requireFunc(\"ws\");\n  EventSourceModule = requireFunc(\"eventsource\");\n}\n/** @private */\n\n\nvar HttpConnection =\n/** @class */\nfunction () {\n  function HttpConnection(url, options) {\n    if (options === void 0) {\n      options = {};\n    }\n\n    this.features = {};\n    Arg.isRequired(url, \"url\");\n    this.logger = createLogger(options.logger);\n    this.baseUrl = this.resolveUrl(url);\n    options = options || {};\n    options.logMessageContent = options.logMessageContent || false;\n    var isNode = typeof window === \"undefined\";\n\n    if (!isNode && typeof WebSocket !== \"undefined\" && !options.WebSocket) {\n      options.WebSocket = WebSocket;\n    } else if (isNode && !options.WebSocket) {\n      if (WebSocketModule) {\n        options.WebSocket = WebSocketModule;\n      }\n    }\n\n    if (!isNode && typeof EventSource !== \"undefined\" && !options.EventSource) {\n      options.EventSource = EventSource;\n    } else if (isNode && !options.EventSource) {\n      if (typeof EventSourceModule !== \"undefined\") {\n        options.EventSource = EventSourceModule;\n      }\n    }\n\n    this.httpClient = options.httpClient || new DefaultHttpClient(this.logger);\n    this.connectionState = 2\n    /* Disconnected */\n    ;\n    this.options = options;\n    this.onreceive = null;\n    this.onclose = null;\n  }\n\n  HttpConnection.prototype.start = function (transferFormat) {\n    transferFormat = transferFormat || TransferFormat.Binary;\n    Arg.isIn(transferFormat, TransferFormat, \"transferFormat\");\n    this.logger.log(LogLevel.Debug, \"Starting connection with transfer format '\" + TransferFormat[transferFormat] + \"'.\");\n\n    if (this.connectionState !== 2\n    /* Disconnected */\n    ) {\n      return Promise.reject(new Error(\"Cannot start a connection that is not in the 'Disconnected' state.\"));\n    }\n\n    this.connectionState = 0\n    /* Connecting */\n    ;\n    this.startPromise = this.startInternal(transferFormat);\n    return this.startPromise;\n  };\n\n  HttpConnection.prototype.send = function (data) {\n    if (this.connectionState !== 1\n    /* Connected */\n    ) {\n      throw new Error(\"Cannot send data if the connection is not in the 'Connected' State.\");\n    } // Transport will not be null if state is connected\n\n\n    return this.transport.send(data);\n  };\n\n  HttpConnection.prototype.stop = function (error) {\n    return __awaiter(this, void 0, void 0, function () {\n      var e_1;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            this.connectionState = 2\n            /* Disconnected */\n            ; // Set error as soon as possible otherwise there is a race between\n            // the transport closing and providing an error and the error from a close message\n            // We would prefer the close message error.\n\n            this.stopError = error;\n            _a.label = 1;\n\n          case 1:\n            _a.trys.push([1, 3,, 4]);\n\n            return [4\n            /*yield*/\n            , this.startPromise];\n\n          case 2:\n            _a.sent();\n\n            return [3\n            /*break*/\n            , 4];\n\n          case 3:\n            e_1 = _a.sent();\n            return [3\n            /*break*/\n            , 4];\n\n          case 4:\n            if (!this.transport) return [3\n            /*break*/\n            , 6];\n            return [4\n            /*yield*/\n            , this.transport.stop()];\n\n          case 5:\n            _a.sent();\n\n            this.transport = undefined;\n            _a.label = 6;\n\n          case 6:\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  HttpConnection.prototype.startInternal = function (transferFormat) {\n    return __awaiter(this, void 0, void 0, function () {\n      var url, negotiateResponse, redirects, _loop_1, this_1, state_1, e_2;\n\n      var _this = this;\n\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            url = this.baseUrl;\n            this.accessTokenFactory = this.options.accessTokenFactory;\n            _a.label = 1;\n\n          case 1:\n            _a.trys.push([1, 12,, 13]);\n\n            if (!this.options.skipNegotiation) return [3\n            /*break*/\n            , 5];\n            if (!(this.options.transport === HttpTransportType.WebSockets)) return [3\n            /*break*/\n            , 3]; // No need to add a connection ID in this case\n\n            this.transport = this.constructTransport(HttpTransportType.WebSockets); // We should just call connect directly in this case.\n            // No fallback or negotiate in this case.\n\n            return [4\n            /*yield*/\n            , this.transport.connect(url, transferFormat)];\n\n          case 2:\n            // We should just call connect directly in this case.\n            // No fallback or negotiate in this case.\n            _a.sent();\n\n            return [3\n            /*break*/\n            , 4];\n\n          case 3:\n            throw Error(\"Negotiation can only be skipped when using the WebSocket transport directly.\");\n\n          case 4:\n            return [3\n            /*break*/\n            , 11];\n\n          case 5:\n            negotiateResponse = null;\n            redirects = 0;\n\n            _loop_1 = function () {\n              var accessToken_1;\n              return __generator(this, function (_a) {\n                switch (_a.label) {\n                  case 0:\n                    return [4\n                    /*yield*/\n                    , this_1.getNegotiationResponse(url)];\n\n                  case 1:\n                    negotiateResponse = _a.sent(); // the user tries to stop the connection when it is being started\n\n                    if (this_1.connectionState === 2\n                    /* Disconnected */\n                    ) {\n                      return [2\n                      /*return*/\n                      , {\n                        value: void 0\n                      }];\n                    }\n\n                    if (negotiateResponse.error) {\n                      throw Error(negotiateResponse.error);\n                    }\n\n                    if (negotiateResponse.ProtocolVersion) {\n                      throw Error(\"Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.\");\n                    }\n\n                    if (negotiateResponse.url) {\n                      url = negotiateResponse.url;\n                    }\n\n                    if (negotiateResponse.accessToken) {\n                      accessToken_1 = negotiateResponse.accessToken;\n\n                      this_1.accessTokenFactory = function () {\n                        return accessToken_1;\n                      };\n                    }\n\n                    redirects++;\n                    return [2\n                    /*return*/\n                    ];\n                }\n              });\n            };\n\n            this_1 = this;\n            _a.label = 6;\n\n          case 6:\n            return [5\n            /*yield**/\n            , _loop_1()];\n\n          case 7:\n            state_1 = _a.sent();\n            if (typeof state_1 === \"object\") return [2\n            /*return*/\n            , state_1.value];\n            _a.label = 8;\n\n          case 8:\n            if (negotiateResponse.url && redirects < MAX_REDIRECTS) return [3\n            /*break*/\n            , 6];\n            _a.label = 9;\n\n          case 9:\n            if (redirects === MAX_REDIRECTS && negotiateResponse.url) {\n              throw Error(\"Negotiate redirection limit exceeded.\");\n            }\n\n            return [4\n            /*yield*/\n            , this.createTransport(url, this.options.transport, negotiateResponse, transferFormat)];\n\n          case 10:\n            _a.sent();\n\n            _a.label = 11;\n\n          case 11:\n            if (this.transport instanceof LongPollingTransport) {\n              this.features.inherentKeepAlive = true;\n            }\n\n            this.transport.onreceive = this.onreceive;\n\n            this.transport.onclose = function (e) {\n              return _this.stopConnection(e);\n            }; // only change the state if we were connecting to not overwrite\n            // the state if the connection is already marked as Disconnected\n\n\n            this.changeState(0\n            /* Connecting */\n            , 1\n            /* Connected */\n            );\n            return [3\n            /*break*/\n            , 13];\n\n          case 12:\n            e_2 = _a.sent();\n            this.logger.log(LogLevel.Error, \"Failed to start the connection: \" + e_2);\n            this.connectionState = 2\n            /* Disconnected */\n            ;\n            this.transport = undefined;\n            throw e_2;\n\n          case 13:\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  HttpConnection.prototype.getNegotiationResponse = function (url) {\n    return __awaiter(this, void 0, void 0, function () {\n      var _a, headers, token, negotiateUrl, response, e_3;\n\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            if (!this.accessTokenFactory) return [3\n            /*break*/\n            , 2];\n            return [4\n            /*yield*/\n            , this.accessTokenFactory()];\n\n          case 1:\n            token = _b.sent();\n\n            if (token) {\n              headers = (_a = {}, _a[\"Authorization\"] = \"Bearer \" + token, _a);\n            }\n\n            _b.label = 2;\n\n          case 2:\n            negotiateUrl = this.resolveNegotiateUrl(url);\n            this.logger.log(LogLevel.Debug, \"Sending negotiation request: \" + negotiateUrl + \".\");\n            _b.label = 3;\n\n          case 3:\n            _b.trys.push([3, 5,, 6]);\n\n            return [4\n            /*yield*/\n            , this.httpClient.post(negotiateUrl, {\n              content: \"\",\n              headers: headers\n            })];\n\n          case 4:\n            response = _b.sent();\n\n            if (response.statusCode !== 200) {\n              throw Error(\"Unexpected status code returned from negotiate \" + response.statusCode);\n            }\n\n            return [2\n            /*return*/\n            , JSON.parse(response.content)];\n\n          case 5:\n            e_3 = _b.sent();\n            this.logger.log(LogLevel.Error, \"Failed to complete negotiation with the server: \" + e_3);\n            throw e_3;\n\n          case 6:\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  HttpConnection.prototype.createConnectUrl = function (url, connectionId) {\n    if (!connectionId) {\n      return url;\n    }\n\n    return url + (url.indexOf(\"?\") === -1 ? \"?\" : \"&\") + (\"id=\" + connectionId);\n  };\n\n  HttpConnection.prototype.createTransport = function (url, requestedTransport, negotiateResponse, requestedTransferFormat) {\n    return __awaiter(this, void 0, void 0, function () {\n      var connectUrl, transports, _i, transports_1, endpoint, transport, ex_1;\n\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            connectUrl = this.createConnectUrl(url, negotiateResponse.connectionId);\n            if (!this.isITransport(requestedTransport)) return [3\n            /*break*/\n            , 2];\n            this.logger.log(LogLevel.Debug, \"Connection was provided an instance of ITransport, using that directly.\");\n            this.transport = requestedTransport;\n            return [4\n            /*yield*/\n            , this.transport.connect(connectUrl, requestedTransferFormat)];\n\n          case 1:\n            _a.sent(); // only change the state if we were connecting to not overwrite\n            // the state if the connection is already marked as Disconnected\n\n\n            this.changeState(0\n            /* Connecting */\n            , 1\n            /* Connected */\n            );\n            return [2\n            /*return*/\n            ];\n\n          case 2:\n            transports = negotiateResponse.availableTransports || [];\n            _i = 0, transports_1 = transports;\n            _a.label = 3;\n\n          case 3:\n            if (!(_i < transports_1.length)) return [3\n            /*break*/\n            , 9];\n            endpoint = transports_1[_i];\n            this.connectionState = 0\n            /* Connecting */\n            ;\n            transport = this.resolveTransport(endpoint, requestedTransport, requestedTransferFormat);\n            if (!(typeof transport === \"number\")) return [3\n            /*break*/\n            , 8];\n            this.transport = this.constructTransport(transport);\n            if (!!negotiateResponse.connectionId) return [3\n            /*break*/\n            , 5];\n            return [4\n            /*yield*/\n            , this.getNegotiationResponse(url)];\n\n          case 4:\n            negotiateResponse = _a.sent();\n            connectUrl = this.createConnectUrl(url, negotiateResponse.connectionId);\n            _a.label = 5;\n\n          case 5:\n            _a.trys.push([5, 7,, 8]);\n\n            return [4\n            /*yield*/\n            , this.transport.connect(connectUrl, requestedTransferFormat)];\n\n          case 6:\n            _a.sent();\n\n            this.changeState(0\n            /* Connecting */\n            , 1\n            /* Connected */\n            );\n            return [2\n            /*return*/\n            ];\n\n          case 7:\n            ex_1 = _a.sent();\n            this.logger.log(LogLevel.Error, \"Failed to start the transport '\" + HttpTransportType[transport] + \"': \" + ex_1);\n            this.connectionState = 2\n            /* Disconnected */\n            ;\n            negotiateResponse.connectionId = undefined;\n            return [3\n            /*break*/\n            , 8];\n\n          case 8:\n            _i++;\n            return [3\n            /*break*/\n            , 3];\n\n          case 9:\n            throw new Error(\"Unable to initialize any of the available transports.\");\n        }\n      });\n    });\n  };\n\n  HttpConnection.prototype.constructTransport = function (transport) {\n    switch (transport) {\n      case HttpTransportType.WebSockets:\n        if (!this.options.WebSocket) {\n          throw new Error(\"'WebSocket' is not supported in your environment.\");\n        }\n\n        return new WebSocketTransport(this.httpClient, this.accessTokenFactory, this.logger, this.options.logMessageContent || false, this.options.WebSocket);\n\n      case HttpTransportType.ServerSentEvents:\n        if (!this.options.EventSource) {\n          throw new Error(\"'EventSource' is not supported in your environment.\");\n        }\n\n        return new ServerSentEventsTransport(this.httpClient, this.accessTokenFactory, this.logger, this.options.logMessageContent || false, this.options.EventSource);\n\n      case HttpTransportType.LongPolling:\n        return new LongPollingTransport(this.httpClient, this.accessTokenFactory, this.logger, this.options.logMessageContent || false);\n\n      default:\n        throw new Error(\"Unknown transport: \" + transport + \".\");\n    }\n  };\n\n  HttpConnection.prototype.resolveTransport = function (endpoint, requestedTransport, requestedTransferFormat) {\n    var transport = HttpTransportType[endpoint.transport];\n\n    if (transport === null || transport === undefined) {\n      this.logger.log(LogLevel.Debug, \"Skipping transport '\" + endpoint.transport + \"' because it is not supported by this client.\");\n    } else {\n      var transferFormats = endpoint.transferFormats.map(function (s) {\n        return TransferFormat[s];\n      });\n\n      if (transportMatches(requestedTransport, transport)) {\n        if (transferFormats.indexOf(requestedTransferFormat) >= 0) {\n          if (transport === HttpTransportType.WebSockets && !this.options.WebSocket || transport === HttpTransportType.ServerSentEvents && !this.options.EventSource) {\n            this.logger.log(LogLevel.Debug, \"Skipping transport '\" + HttpTransportType[transport] + \"' because it is not supported in your environment.'\");\n          } else {\n            this.logger.log(LogLevel.Debug, \"Selecting transport '\" + HttpTransportType[transport] + \"'.\");\n            return transport;\n          }\n        } else {\n          this.logger.log(LogLevel.Debug, \"Skipping transport '\" + HttpTransportType[transport] + \"' because it does not support the requested transfer format '\" + TransferFormat[requestedTransferFormat] + \"'.\");\n        }\n      } else {\n        this.logger.log(LogLevel.Debug, \"Skipping transport '\" + HttpTransportType[transport] + \"' because it was disabled by the client.\");\n      }\n    }\n\n    return null;\n  };\n\n  HttpConnection.prototype.isITransport = function (transport) {\n    return transport && typeof transport === \"object\" && \"connect\" in transport;\n  };\n\n  HttpConnection.prototype.changeState = function (from, to) {\n    if (this.connectionState === from) {\n      this.connectionState = to;\n      return true;\n    }\n\n    return false;\n  };\n\n  HttpConnection.prototype.stopConnection = function (error) {\n    this.transport = undefined; // If we have a stopError, it takes precedence over the error from the transport\n\n    error = this.stopError || error;\n\n    if (error) {\n      this.logger.log(LogLevel.Error, \"Connection disconnected with error '\" + error + \"'.\");\n    } else {\n      this.logger.log(LogLevel.Information, \"Connection disconnected.\");\n    }\n\n    this.connectionState = 2\n    /* Disconnected */\n    ;\n\n    if (this.onclose) {\n      this.onclose(error);\n    }\n  };\n\n  HttpConnection.prototype.resolveUrl = function (url) {\n    // startsWith is not supported in IE\n    if (url.lastIndexOf(\"https://\", 0) === 0 || url.lastIndexOf(\"http://\", 0) === 0) {\n      return url;\n    }\n\n    if (typeof window === \"undefined\" || !window || !window.document) {\n      throw new Error(\"Cannot resolve '\" + url + \"'.\");\n    } // Setting the url to the href propery of an anchor tag handles normalization\n    // for us. There are 3 main cases.\n    // 1. Relative  path normalization e.g \"b\" -> \"http://localhost:5000/a/b\"\n    // 2. Absolute path normalization e.g \"/a/b\" -> \"http://localhost:5000/a/b\"\n    // 3. Networkpath reference normalization e.g \"//localhost:5000/a/b\" -> \"http://localhost:5000/a/b\"\n\n\n    var aTag = window.document.createElement(\"a\");\n    aTag.href = url;\n    this.logger.log(LogLevel.Information, \"Normalizing '\" + url + \"' to '\" + aTag.href + \"'.\");\n    return aTag.href;\n  };\n\n  HttpConnection.prototype.resolveNegotiateUrl = function (url) {\n    var index = url.indexOf(\"?\");\n    var negotiateUrl = url.substring(0, index === -1 ? url.length : index);\n\n    if (negotiateUrl[negotiateUrl.length - 1] !== \"/\") {\n      negotiateUrl += \"/\";\n    }\n\n    negotiateUrl += \"negotiate\";\n    negotiateUrl += index === -1 ? \"\" : url.substring(index);\n    return negotiateUrl;\n  };\n\n  return HttpConnection;\n}();\n\nexport { HttpConnection };\n\nfunction transportMatches(requestedTransport, actualTransport) {\n  return !requestedTransport || (actualTransport & requestedTransport) !== 0;\n}","map":{"version":3,"names":["__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","__generator","body","_","label","sent","t","trys","ops","f","y","g","verb","Symbol","iterator","n","v","op","TypeError","call","pop","length","push","DefaultHttpClient","LogLevel","HttpTransportType","TransferFormat","LongPollingTransport","ServerSentEventsTransport","Arg","createLogger","WebSocketTransport","MAX_REDIRECTS","WebSocketModule","EventSourceModule","window","require","requireFunc","__webpack_require__","__non_webpack_require__","HttpConnection","url","options","features","isRequired","logger","baseUrl","resolveUrl","logMessageContent","isNode","WebSocket","EventSource","httpClient","connectionState","onreceive","onclose","prototype","start","transferFormat","Binary","isIn","log","Debug","Error","startPromise","startInternal","send","data","transport","stop","error","e_1","_a","stopError","undefined","negotiateResponse","redirects","_loop_1","this_1","state_1","e_2","_this","accessTokenFactory","skipNegotiation","WebSockets","constructTransport","connect","accessToken_1","getNegotiationResponse","ProtocolVersion","accessToken","createTransport","inherentKeepAlive","stopConnection","changeState","headers","token","negotiateUrl","response","e_3","_b","resolveNegotiateUrl","post","content","statusCode","JSON","parse","createConnectUrl","connectionId","indexOf","requestedTransport","requestedTransferFormat","connectUrl","transports","_i","transports_1","endpoint","ex_1","isITransport","availableTransports","resolveTransport","ServerSentEvents","LongPolling","transferFormats","map","s","transportMatches","from","to","Information","lastIndexOf","document","aTag","createElement","href","index","substring","actualTransport"],"sources":["C:/Users/ALON/Projects/SOAProject/TalkBackProject/myapp/node_modules/@aspnet/signalr/dist/esm/HttpConnection.js"],"sourcesContent":["// Copyright (c) .NET Foundation. All rights reserved.\r\n// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nimport { DefaultHttpClient } from \"./DefaultHttpClient\";\r\nimport { LogLevel } from \"./ILogger\";\r\nimport { HttpTransportType, TransferFormat } from \"./ITransport\";\r\nimport { LongPollingTransport } from \"./LongPollingTransport\";\r\nimport { ServerSentEventsTransport } from \"./ServerSentEventsTransport\";\r\nimport { Arg, createLogger } from \"./Utils\";\r\nimport { WebSocketTransport } from \"./WebSocketTransport\";\r\nvar MAX_REDIRECTS = 100;\r\nvar WebSocketModule = null;\r\nvar EventSourceModule = null;\r\nif (typeof window === \"undefined\" && typeof require !== \"undefined\") {\r\n    // In order to ignore the dynamic require in webpack builds we need to do this magic\r\n    // @ts-ignore: TS doesn't know about these names\r\n    var requireFunc = typeof __webpack_require__ === \"function\" ? __non_webpack_require__ : require;\r\n    WebSocketModule = requireFunc(\"ws\");\r\n    EventSourceModule = requireFunc(\"eventsource\");\r\n}\r\n/** @private */\r\nvar HttpConnection = /** @class */ (function () {\r\n    function HttpConnection(url, options) {\r\n        if (options === void 0) { options = {}; }\r\n        this.features = {};\r\n        Arg.isRequired(url, \"url\");\r\n        this.logger = createLogger(options.logger);\r\n        this.baseUrl = this.resolveUrl(url);\r\n        options = options || {};\r\n        options.logMessageContent = options.logMessageContent || false;\r\n        var isNode = typeof window === \"undefined\";\r\n        if (!isNode && typeof WebSocket !== \"undefined\" && !options.WebSocket) {\r\n            options.WebSocket = WebSocket;\r\n        }\r\n        else if (isNode && !options.WebSocket) {\r\n            if (WebSocketModule) {\r\n                options.WebSocket = WebSocketModule;\r\n            }\r\n        }\r\n        if (!isNode && typeof EventSource !== \"undefined\" && !options.EventSource) {\r\n            options.EventSource = EventSource;\r\n        }\r\n        else if (isNode && !options.EventSource) {\r\n            if (typeof EventSourceModule !== \"undefined\") {\r\n                options.EventSource = EventSourceModule;\r\n            }\r\n        }\r\n        this.httpClient = options.httpClient || new DefaultHttpClient(this.logger);\r\n        this.connectionState = 2 /* Disconnected */;\r\n        this.options = options;\r\n        this.onreceive = null;\r\n        this.onclose = null;\r\n    }\r\n    HttpConnection.prototype.start = function (transferFormat) {\r\n        transferFormat = transferFormat || TransferFormat.Binary;\r\n        Arg.isIn(transferFormat, TransferFormat, \"transferFormat\");\r\n        this.logger.log(LogLevel.Debug, \"Starting connection with transfer format '\" + TransferFormat[transferFormat] + \"'.\");\r\n        if (this.connectionState !== 2 /* Disconnected */) {\r\n            return Promise.reject(new Error(\"Cannot start a connection that is not in the 'Disconnected' state.\"));\r\n        }\r\n        this.connectionState = 0 /* Connecting */;\r\n        this.startPromise = this.startInternal(transferFormat);\r\n        return this.startPromise;\r\n    };\r\n    HttpConnection.prototype.send = function (data) {\r\n        if (this.connectionState !== 1 /* Connected */) {\r\n            throw new Error(\"Cannot send data if the connection is not in the 'Connected' State.\");\r\n        }\r\n        // Transport will not be null if state is connected\r\n        return this.transport.send(data);\r\n    };\r\n    HttpConnection.prototype.stop = function (error) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var e_1;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        this.connectionState = 2 /* Disconnected */;\r\n                        // Set error as soon as possible otherwise there is a race between\r\n                        // the transport closing and providing an error and the error from a close message\r\n                        // We would prefer the close message error.\r\n                        this.stopError = error;\r\n                        _a.label = 1;\r\n                    case 1:\r\n                        _a.trys.push([1, 3, , 4]);\r\n                        return [4 /*yield*/, this.startPromise];\r\n                    case 2:\r\n                        _a.sent();\r\n                        return [3 /*break*/, 4];\r\n                    case 3:\r\n                        e_1 = _a.sent();\r\n                        return [3 /*break*/, 4];\r\n                    case 4:\r\n                        if (!this.transport) return [3 /*break*/, 6];\r\n                        return [4 /*yield*/, this.transport.stop()];\r\n                    case 5:\r\n                        _a.sent();\r\n                        this.transport = undefined;\r\n                        _a.label = 6;\r\n                    case 6: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HttpConnection.prototype.startInternal = function (transferFormat) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var url, negotiateResponse, redirects, _loop_1, this_1, state_1, e_2;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        url = this.baseUrl;\r\n                        this.accessTokenFactory = this.options.accessTokenFactory;\r\n                        _a.label = 1;\r\n                    case 1:\r\n                        _a.trys.push([1, 12, , 13]);\r\n                        if (!this.options.skipNegotiation) return [3 /*break*/, 5];\r\n                        if (!(this.options.transport === HttpTransportType.WebSockets)) return [3 /*break*/, 3];\r\n                        // No need to add a connection ID in this case\r\n                        this.transport = this.constructTransport(HttpTransportType.WebSockets);\r\n                        // We should just call connect directly in this case.\r\n                        // No fallback or negotiate in this case.\r\n                        return [4 /*yield*/, this.transport.connect(url, transferFormat)];\r\n                    case 2:\r\n                        // We should just call connect directly in this case.\r\n                        // No fallback or negotiate in this case.\r\n                        _a.sent();\r\n                        return [3 /*break*/, 4];\r\n                    case 3: throw Error(\"Negotiation can only be skipped when using the WebSocket transport directly.\");\r\n                    case 4: return [3 /*break*/, 11];\r\n                    case 5:\r\n                        negotiateResponse = null;\r\n                        redirects = 0;\r\n                        _loop_1 = function () {\r\n                            var accessToken_1;\r\n                            return __generator(this, function (_a) {\r\n                                switch (_a.label) {\r\n                                    case 0: return [4 /*yield*/, this_1.getNegotiationResponse(url)];\r\n                                    case 1:\r\n                                        negotiateResponse = _a.sent();\r\n                                        // the user tries to stop the connection when it is being started\r\n                                        if (this_1.connectionState === 2 /* Disconnected */) {\r\n                                            return [2 /*return*/, { value: void 0 }];\r\n                                        }\r\n                                        if (negotiateResponse.error) {\r\n                                            throw Error(negotiateResponse.error);\r\n                                        }\r\n                                        if (negotiateResponse.ProtocolVersion) {\r\n                                            throw Error(\"Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.\");\r\n                                        }\r\n                                        if (negotiateResponse.url) {\r\n                                            url = negotiateResponse.url;\r\n                                        }\r\n                                        if (negotiateResponse.accessToken) {\r\n                                            accessToken_1 = negotiateResponse.accessToken;\r\n                                            this_1.accessTokenFactory = function () { return accessToken_1; };\r\n                                        }\r\n                                        redirects++;\r\n                                        return [2 /*return*/];\r\n                                }\r\n                            });\r\n                        };\r\n                        this_1 = this;\r\n                        _a.label = 6;\r\n                    case 6: return [5 /*yield**/, _loop_1()];\r\n                    case 7:\r\n                        state_1 = _a.sent();\r\n                        if (typeof state_1 === \"object\")\r\n                            return [2 /*return*/, state_1.value];\r\n                        _a.label = 8;\r\n                    case 8:\r\n                        if (negotiateResponse.url && redirects < MAX_REDIRECTS) return [3 /*break*/, 6];\r\n                        _a.label = 9;\r\n                    case 9:\r\n                        if (redirects === MAX_REDIRECTS && negotiateResponse.url) {\r\n                            throw Error(\"Negotiate redirection limit exceeded.\");\r\n                        }\r\n                        return [4 /*yield*/, this.createTransport(url, this.options.transport, negotiateResponse, transferFormat)];\r\n                    case 10:\r\n                        _a.sent();\r\n                        _a.label = 11;\r\n                    case 11:\r\n                        if (this.transport instanceof LongPollingTransport) {\r\n                            this.features.inherentKeepAlive = true;\r\n                        }\r\n                        this.transport.onreceive = this.onreceive;\r\n                        this.transport.onclose = function (e) { return _this.stopConnection(e); };\r\n                        // only change the state if we were connecting to not overwrite\r\n                        // the state if the connection is already marked as Disconnected\r\n                        this.changeState(0 /* Connecting */, 1 /* Connected */);\r\n                        return [3 /*break*/, 13];\r\n                    case 12:\r\n                        e_2 = _a.sent();\r\n                        this.logger.log(LogLevel.Error, \"Failed to start the connection: \" + e_2);\r\n                        this.connectionState = 2 /* Disconnected */;\r\n                        this.transport = undefined;\r\n                        throw e_2;\r\n                    case 13: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HttpConnection.prototype.getNegotiationResponse = function (url) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _a, headers, token, negotiateUrl, response, e_3;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        if (!this.accessTokenFactory) return [3 /*break*/, 2];\r\n                        return [4 /*yield*/, this.accessTokenFactory()];\r\n                    case 1:\r\n                        token = _b.sent();\r\n                        if (token) {\r\n                            headers = (_a = {},\r\n                                _a[\"Authorization\"] = \"Bearer \" + token,\r\n                                _a);\r\n                        }\r\n                        _b.label = 2;\r\n                    case 2:\r\n                        negotiateUrl = this.resolveNegotiateUrl(url);\r\n                        this.logger.log(LogLevel.Debug, \"Sending negotiation request: \" + negotiateUrl + \".\");\r\n                        _b.label = 3;\r\n                    case 3:\r\n                        _b.trys.push([3, 5, , 6]);\r\n                        return [4 /*yield*/, this.httpClient.post(negotiateUrl, {\r\n                                content: \"\",\r\n                                headers: headers,\r\n                            })];\r\n                    case 4:\r\n                        response = _b.sent();\r\n                        if (response.statusCode !== 200) {\r\n                            throw Error(\"Unexpected status code returned from negotiate \" + response.statusCode);\r\n                        }\r\n                        return [2 /*return*/, JSON.parse(response.content)];\r\n                    case 5:\r\n                        e_3 = _b.sent();\r\n                        this.logger.log(LogLevel.Error, \"Failed to complete negotiation with the server: \" + e_3);\r\n                        throw e_3;\r\n                    case 6: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HttpConnection.prototype.createConnectUrl = function (url, connectionId) {\r\n        if (!connectionId) {\r\n            return url;\r\n        }\r\n        return url + (url.indexOf(\"?\") === -1 ? \"?\" : \"&\") + (\"id=\" + connectionId);\r\n    };\r\n    HttpConnection.prototype.createTransport = function (url, requestedTransport, negotiateResponse, requestedTransferFormat) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var connectUrl, transports, _i, transports_1, endpoint, transport, ex_1;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        connectUrl = this.createConnectUrl(url, negotiateResponse.connectionId);\r\n                        if (!this.isITransport(requestedTransport)) return [3 /*break*/, 2];\r\n                        this.logger.log(LogLevel.Debug, \"Connection was provided an instance of ITransport, using that directly.\");\r\n                        this.transport = requestedTransport;\r\n                        return [4 /*yield*/, this.transport.connect(connectUrl, requestedTransferFormat)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        // only change the state if we were connecting to not overwrite\r\n                        // the state if the connection is already marked as Disconnected\r\n                        this.changeState(0 /* Connecting */, 1 /* Connected */);\r\n                        return [2 /*return*/];\r\n                    case 2:\r\n                        transports = negotiateResponse.availableTransports || [];\r\n                        _i = 0, transports_1 = transports;\r\n                        _a.label = 3;\r\n                    case 3:\r\n                        if (!(_i < transports_1.length)) return [3 /*break*/, 9];\r\n                        endpoint = transports_1[_i];\r\n                        this.connectionState = 0 /* Connecting */;\r\n                        transport = this.resolveTransport(endpoint, requestedTransport, requestedTransferFormat);\r\n                        if (!(typeof transport === \"number\")) return [3 /*break*/, 8];\r\n                        this.transport = this.constructTransport(transport);\r\n                        if (!!negotiateResponse.connectionId) return [3 /*break*/, 5];\r\n                        return [4 /*yield*/, this.getNegotiationResponse(url)];\r\n                    case 4:\r\n                        negotiateResponse = _a.sent();\r\n                        connectUrl = this.createConnectUrl(url, negotiateResponse.connectionId);\r\n                        _a.label = 5;\r\n                    case 5:\r\n                        _a.trys.push([5, 7, , 8]);\r\n                        return [4 /*yield*/, this.transport.connect(connectUrl, requestedTransferFormat)];\r\n                    case 6:\r\n                        _a.sent();\r\n                        this.changeState(0 /* Connecting */, 1 /* Connected */);\r\n                        return [2 /*return*/];\r\n                    case 7:\r\n                        ex_1 = _a.sent();\r\n                        this.logger.log(LogLevel.Error, \"Failed to start the transport '\" + HttpTransportType[transport] + \"': \" + ex_1);\r\n                        this.connectionState = 2 /* Disconnected */;\r\n                        negotiateResponse.connectionId = undefined;\r\n                        return [3 /*break*/, 8];\r\n                    case 8:\r\n                        _i++;\r\n                        return [3 /*break*/, 3];\r\n                    case 9: throw new Error(\"Unable to initialize any of the available transports.\");\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HttpConnection.prototype.constructTransport = function (transport) {\r\n        switch (transport) {\r\n            case HttpTransportType.WebSockets:\r\n                if (!this.options.WebSocket) {\r\n                    throw new Error(\"'WebSocket' is not supported in your environment.\");\r\n                }\r\n                return new WebSocketTransport(this.httpClient, this.accessTokenFactory, this.logger, this.options.logMessageContent || false, this.options.WebSocket);\r\n            case HttpTransportType.ServerSentEvents:\r\n                if (!this.options.EventSource) {\r\n                    throw new Error(\"'EventSource' is not supported in your environment.\");\r\n                }\r\n                return new ServerSentEventsTransport(this.httpClient, this.accessTokenFactory, this.logger, this.options.logMessageContent || false, this.options.EventSource);\r\n            case HttpTransportType.LongPolling:\r\n                return new LongPollingTransport(this.httpClient, this.accessTokenFactory, this.logger, this.options.logMessageContent || false);\r\n            default:\r\n                throw new Error(\"Unknown transport: \" + transport + \".\");\r\n        }\r\n    };\r\n    HttpConnection.prototype.resolveTransport = function (endpoint, requestedTransport, requestedTransferFormat) {\r\n        var transport = HttpTransportType[endpoint.transport];\r\n        if (transport === null || transport === undefined) {\r\n            this.logger.log(LogLevel.Debug, \"Skipping transport '\" + endpoint.transport + \"' because it is not supported by this client.\");\r\n        }\r\n        else {\r\n            var transferFormats = endpoint.transferFormats.map(function (s) { return TransferFormat[s]; });\r\n            if (transportMatches(requestedTransport, transport)) {\r\n                if (transferFormats.indexOf(requestedTransferFormat) >= 0) {\r\n                    if ((transport === HttpTransportType.WebSockets && !this.options.WebSocket) ||\r\n                        (transport === HttpTransportType.ServerSentEvents && !this.options.EventSource)) {\r\n                        this.logger.log(LogLevel.Debug, \"Skipping transport '\" + HttpTransportType[transport] + \"' because it is not supported in your environment.'\");\r\n                    }\r\n                    else {\r\n                        this.logger.log(LogLevel.Debug, \"Selecting transport '\" + HttpTransportType[transport] + \"'.\");\r\n                        return transport;\r\n                    }\r\n                }\r\n                else {\r\n                    this.logger.log(LogLevel.Debug, \"Skipping transport '\" + HttpTransportType[transport] + \"' because it does not support the requested transfer format '\" + TransferFormat[requestedTransferFormat] + \"'.\");\r\n                }\r\n            }\r\n            else {\r\n                this.logger.log(LogLevel.Debug, \"Skipping transport '\" + HttpTransportType[transport] + \"' because it was disabled by the client.\");\r\n            }\r\n        }\r\n        return null;\r\n    };\r\n    HttpConnection.prototype.isITransport = function (transport) {\r\n        return transport && typeof (transport) === \"object\" && \"connect\" in transport;\r\n    };\r\n    HttpConnection.prototype.changeState = function (from, to) {\r\n        if (this.connectionState === from) {\r\n            this.connectionState = to;\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n    HttpConnection.prototype.stopConnection = function (error) {\r\n        this.transport = undefined;\r\n        // If we have a stopError, it takes precedence over the error from the transport\r\n        error = this.stopError || error;\r\n        if (error) {\r\n            this.logger.log(LogLevel.Error, \"Connection disconnected with error '\" + error + \"'.\");\r\n        }\r\n        else {\r\n            this.logger.log(LogLevel.Information, \"Connection disconnected.\");\r\n        }\r\n        this.connectionState = 2 /* Disconnected */;\r\n        if (this.onclose) {\r\n            this.onclose(error);\r\n        }\r\n    };\r\n    HttpConnection.prototype.resolveUrl = function (url) {\r\n        // startsWith is not supported in IE\r\n        if (url.lastIndexOf(\"https://\", 0) === 0 || url.lastIndexOf(\"http://\", 0) === 0) {\r\n            return url;\r\n        }\r\n        if (typeof window === \"undefined\" || !window || !window.document) {\r\n            throw new Error(\"Cannot resolve '\" + url + \"'.\");\r\n        }\r\n        // Setting the url to the href propery of an anchor tag handles normalization\r\n        // for us. There are 3 main cases.\r\n        // 1. Relative  path normalization e.g \"b\" -> \"http://localhost:5000/a/b\"\r\n        // 2. Absolute path normalization e.g \"/a/b\" -> \"http://localhost:5000/a/b\"\r\n        // 3. Networkpath reference normalization e.g \"//localhost:5000/a/b\" -> \"http://localhost:5000/a/b\"\r\n        var aTag = window.document.createElement(\"a\");\r\n        aTag.href = url;\r\n        this.logger.log(LogLevel.Information, \"Normalizing '\" + url + \"' to '\" + aTag.href + \"'.\");\r\n        return aTag.href;\r\n    };\r\n    HttpConnection.prototype.resolveNegotiateUrl = function (url) {\r\n        var index = url.indexOf(\"?\");\r\n        var negotiateUrl = url.substring(0, index === -1 ? url.length : index);\r\n        if (negotiateUrl[negotiateUrl.length - 1] !== \"/\") {\r\n            negotiateUrl += \"/\";\r\n        }\r\n        negotiateUrl += \"negotiate\";\r\n        negotiateUrl += index === -1 ? \"\" : url.substring(index);\r\n        return negotiateUrl;\r\n    };\r\n    return HttpConnection;\r\n}());\r\nexport { HttpConnection };\r\nfunction transportMatches(requestedTransport, actualTransport) {\r\n    return !requestedTransport || ((actualTransport & requestedTransport) !== 0);\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}